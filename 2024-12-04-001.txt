resources
// Filter to only include resources from our target subscription
| where subscriptionId == "00000000-0000-0000-0000-000000000000"
// Join with subscriptions to get the managed resource's subscription name
| join kind=leftouter (
    subscriptions
    | project managedSubId = subscriptionId, managedSubName = name
) on $left.subscriptionId == $right.managedSubId
// Join with resources table again to get managing resource information
| join kind=leftouter (
    resources
    | where isnotempty(managedBy)
    | extend managingSubId = tostring(split(managedBy, '/')[2])
    | extend managingRG = tostring(split(managedBy, '/')[4])
    | project 
        managedId = id,
        managingSubId,
        managingRG
) on $left.id == $right.managedId
// Join with subscriptions again to get the managing subscription name
| join kind=leftouter (
    subscriptions
    | project managingSubId = subscriptionId, managingSubName = name
) on $left.managingSubId == $right.managingSubId
// Only include resources that have a managing resource
| where isnotempty(managedBy)
// Filter to resources where the managing resource is in a different resource group
| where resourceGroup != managingRG
| project
    managedResourceName = name,
    managedResourceType = type,
    managedResourceGroup = resourceGroup,
    managedSubscriptionName = managedSubName,
    managingResourceGroup = managingRG,
    managingSubscriptionName = managingSubName,
    managedByResourceId = managedBy
| order by managedResourceGroup asc, managedResourceName asc